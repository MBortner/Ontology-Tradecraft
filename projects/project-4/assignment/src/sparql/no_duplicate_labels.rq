# Title: 
#     No Duplicate Labels
# Constraint Description: 
#     No two ontology elements shall have the same rdfs:label.
# Severity:
#     Warning

# Title:
#   No Duplicate Labels (lexical)
# Constraint Description:
#   No two subjects shall share the same rdfs:label lexical string.
# Severity: Warning
#
# A valid ontology should return ZERO rows.

PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

SELECT DISTINCT ?element ?element2 ?label ?error
WHERE {
  ?element rdfs:label ?label .
  ?element2 rdfs:label ?label .
  FILTER (?element != ?element2)
  FILTER (!isBlank(?element))
  FILTER (!isBlank(?element2))
  BIND (concat("WARNING: The following ontology elements have the same rdfs:label ", str(?element), " and ", str(?element2)) AS ?error)
}
ORDER BY DESC(UCASE(str(?label)))

#!/usr/bin/env python3
"""
check_no_duplicate_labels.py
Warn if two (distinct) non-blank subjects share identical rdfs:label literal (same lexical + lang).
"""
import sys
from rdflib import Graph, RDFS, Literal

def main(path):
    g = Graph()
    g.parse(path)
    label_map = {}  # (text, lang) -> set(subjects)
    for s, o in g.subject_objects(RDFS.label):
        if isinstance(o, Literal):
            key = (str(o), o.language)
            label_map.setdefault(key, set()).add(s)
    duplicates = [(k, v) for k, v in label_map.items() if len(v) > 1]
    if duplicates:
        print("WARNING: Duplicate rdfs:label values detected:")
        for (text, lang), subjects in duplicates:
            print(f"\nLabel (lang={lang}): {repr(text)}")
            for subj in subjects:
                print(" -", subj)
    else:
        print("PASS: No duplicate rdfs:label values found.")
    sys.exit(0)

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python check_no_duplicate_labels.py <ontology-file>")
        sys.exit(2)
    main(sys.argv[1])
